 <dom-module id="spendtrade-dialog">
    <template>
  
    <style>   
       :host {
        display: block;
      }
            
    </style>
    
    
    <paper-dialog id="dialog" modal>
      <h3>{{localize('youareabouttospendtrade')}}</h3>
      <p/>
      
      <div>{{localize('specifyamountofproduction')}}</div>
      
      <div>{{localize('tradetospend')}}[[tradetospend]]</div>
      
      <figurenumber-widget id="numbproduction"></figurenumber-widget>
                        
      <div class="buttons">

        <paper-button on-click="_onSpend">
            <iron-icon src="images/tokens/trade.svg"></iron-icon>  
           {{localize('spendtrade')}}
        </paper-button>
                
        <paper-button dialog-dismiss>{{localize('cancellabel')}}</paper-button> 
      </div>
      
    </paper-dialog>
  </template>

  <script>
    class SpendTradeDialog extends Polymer.CivLocalize(Polymer.Element) {
      static get is() { return 'spendtrade-dialog'; }
      
      static get properties() {
          return {
            pa: {
              type: Object,
              value: undefined
            },
            
            tradetospend : {
            	type : Number
            },
            
            maxproduction : {
            	type : Number
            }
                       
          }
      }
      
      _onSpend() {
          const prod = this.$.numbproduction.getNumb()
          if (prod < 1 || prod > this.maxproduction) {
              C.alertdialog(this.localize('productionfromtradeshouldbe',"max",this.maxproduction))
              return
          }
          C.confirmdialog(this.localize('areyousurequestion'),e => {
              this.closeIt()
              const pa = this.pa
              pa.param = prod
              C.executeC("SPENDTRADE",pa)
          })          

      }
      
      _numberChanged(newValue,oldValue) {
          const y = C.getyourdeck()
          this.tradetospend = (this.maxproduction -newValue) * y.tradeforprod
          if (this.tradetospend < 0) this.tradetospend = "?" 
      }
                  
      openIt(pa) {
    	  const y = C.getyourdeck()
          this.pa = pa
          this.$.dialog.open();
          const e = this.$.numbproduction
          this.maxproduction = Math.floor(y.trade/y.tradeforprod)
          e.numberChanged = (newValue,oldValue) => this._numberChanged(newValue,oldValue)
          e.draw('amountofproduction',1,this.maxproduction)
      }
      
      closeIt() {
          this.$.dialog.close();
        }
     
    }

    window.customElements.define(SpendTradeDialog.is, SpendTradeDialog);
  </script>
</dom-module>