<dom-module id="civ-square">

<template>

<style>
    /* local styles go here */
    :host {
      display: inline-block;  
      /* display: none;*/
      width : 120px;
      height : 40px;
      /* background: transparent; */
      background: #eaeaea;
    }
    paper-button {
      text-transform: none;
   }
    :host([Water]) {
        background: LightBlue;
        }

    :host([Desert]) {
        background: LightGoldenRodYellow;
        }
        
    :host([Forest]) {
        background: ForestGreen 
        }

    :host([Grassland]) {
        background: DarkSeaGreen 
        }

    :host([Mountain]) {
        background: DarkOliveGreen 
        } 
       
      paper-item {
      --paper-item-min-height : 10px;
      --paper-item: {
          font-size: 80%;
          line-height: 120%; 
        };
      }
  </style>
</custom-style>
   
  </style>
  
   <paper-item>
  <paper-item-body three-line>
    <div>[[line1]]</div>
    <div secondary>[[line2]]</div>
    <div>[[line3]]</div>
  </paper-item-body>
</paper-item>

</template>

<script>
class CivSquare extends Polymer.GestureEventListeners(Polymer.Element) {

    constructor() {
        super();
        Polymer.Gestures.addListener(this, 'tap', () => this.handleClick());
    }

    static get is() { 
    	
    	return 'civ-square';  
    	}
    
    handleClick() {    	
        var res = C.getsquare(this.row,this.col)        
        if (res.terrain == null) return
        var co = C.getcurrentcommand()
        var i = C.getitemizedcommand()
        if (C.emptyS(co)) return        
        C.confexecutedialog("Do you want " + co + " here ?",co,this.row,this.col,null)
    }
    
  static get observers() { 
	  return [
    'refresh(jsdata)'
    ]
  }


    // Declare properties for the element's public API
    static get properties() {
      return {
    	line1 : {
    		type : String,
    		value : undefined
    	},
    	line2 : {
    		type : String,
    		value : undefined
    	},
    	line3 : {
    		type : String,
    		value : undefined
    	},

        row: {
          type: Number,
          value: -1
        },
        col : {
        	type : Number,
        	val : -1
        },
        jsdata : {
        	type : String,
        	val : undefined
        },
        terrains : {
        	type : Array,
        	readOnly: true,
        	value : ["mountain","water","forest","grassland","desert"]
        }
      }
    }
    
//   ready() {
//	   console.log("ready")
//   }

   created() {
	   console.log("created")
   }
   
   attached() {
	   console.log("attached")
   }
    
   refresh(jsdata) {
	   if (C.emptyS(jsdata)) return
	   var res = JSON.parse(jsdata);
	   	   
	   // remove previously assigned attributes
	   for (var i=0; i<this.terrains.length; i++) {
		   C.removeattr(this,this.terrains[i])
	   }
	   if (res.terrain == null) return
		   
       this.setAttribute(res.terrain,1)
       if (res.city != null) {
    	   this.line1 = res.city
    	   this.line2 = res.civ
    	   this.line3 = "P:" + res.production
    	   return
       }
       if (res.capciv == null) this.line1 = res.terrain
       else this.line1 = "*" + res.terrain + "* Capital"
       var s = ""
       if (res.trade != -1) s = s + "T:" + res.trade + " "
       if (res.production != -1) s = s + "P:" + res.production + " "
       if (res.resource != null) s = s + "R:" + res.resource
       this.line2 = s
       s = ""
       if (res.numberofArmies > 0 || res.numberofScouts > 0) {
    	   s = res.civ + " A:" + res.numberofArmies + " S:" + res.numberofScouts
       }
       this.line3 = s
   }
       

  }

  // Register the x-custom element with the browser
  customElements.define(CivSquare.is, CivSquare);
</script>

</dom-module>

