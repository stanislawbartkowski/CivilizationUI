<dom-module id="civ-player"> 

<template>

<style>

  .undobuttons {
    position: relative;
    margin: 0;
    @apply --layout-horizontal;
/*    @apply --layout-end-justified; */ 
  }
  
  .undo {
    width: 15px;
  }

  .civname {
    border-radius: 15px;
    width: 90%;
    height: 30px; 
    text-align: center;
    font-size: 150%;
    padding-top: 5px;
    background-color : white;
    margin-left: 5px;
  }
  
  .statusstyle {
  }
  
  .actionbox {
     margin-left: 5px;
     margin-top: 2px;
     border:1px ridge gray ; 
     display: block; 
     border-radius: 5px;
     width: 90%;
  }

  .unitbox {
     margin-left: 5px;
     margin-top: 2px;
     border:1px ridge gray ; 
     display: block; 
     border-radius: 5px;
     width: 90%;
  }
    
  #startofturn  {
  }

  #trade  {
  }

  #citymanagement  {   
  }

  #movement  {   
  }
  
  #research  {   
  }  
       
</style>
	
	<div class="civname">[[civname]]</div>

<span class = "statusstyle actionbox">
  <paper-icon-item>
    <iron-icon src="images/tokens/trade.svg" slot="item-icon"></iron-icon>
    [[numberoftrade]]
  </paper-icon-item>
	
  <paper-icon-item>
    <iron-icon src="images/cities/city.svg" slot="item-icon"></iron-icon>
    [[citieslimit]]
  </paper-icon-item>

  <paper-icon-item>
    <iron-icon src="images/figures/army.svg" slot="item-icon"></iron-icon>
    [[armieslimit]]
  </paper-icon-item>

  <paper-icon-item>
    <iron-icon src="images/figures/scout.svg" slot="item-icon"></iron-icon>
    [[scoutslimit]]
  </paper-icon-item>

</span>

<span id="unitbox" class="unitbox" >
  <civ-units id="infantry"></civ-units>
  <civ-units id="artillery"></civ-units>
  <civ-units id="mounted"></civ-units>
  <civ-units id="aircraft"></civ-units>
</span>


<paper-item>
  <div>[[currentcommand]]</div>
 </paper-item>

 <paper-icon-item id="endofphase" on-click="_onClick">
  <iron-icon icon="done" slot="item-icon"></iron-icon> <span>EndOfPhase</span>
 </paper-icon-item>

<span id="startofturn" class="actionbox">
 
	<paper-icon-item id="setcapital" on-click="_onClick">
        <iron-icon src="images/cities/capital.svg" slot="item-icon"></iron-icon> 
        <span>{{localize('capital')}}</span>
	</paper-icon-item>
	
	<paper-icon-item id="setcity" on-click="_onClick"> 
	   <iron-icon src="images/cities/city.svg" slot="item-icon"></iron-icon> 
	   <span>{{localize('setcity')}}</span>
	</paper-icon-item>
	
	<paper-icon-item id="setarmy" on-click="_onClick">
	  <iron-icon src="images/figures/army.svg"  slot="item-icon"></iron-icon> 
	  <span>{{localize('deployarmy')}}</span>
    </paper-icon-item>
		
	<paper-icon-item id="setscout" on-click="_onClick"> 
	  <iron-icon src="images/figures/scout.svg"  slot="item-icon"></iron-icon> 
	  <span>{{localize('deployscout')}}</span> 
   </paper-icon-item>
</span>

<span id="trade" class="actionbox" style="display:none">
</span>

<span id="citymanagement" class="actionbox" style="display:none">

<paper-menu-button> 

    <paper-icon-item slot="dropdown-trigger">
      <iron-icon icon="menu" slot="item-icon"></iron-icon>       
      <span>{{localize('units')}}</span>
    </paper-icon-item>

    <paper-tabs  slot="dropdown-content" class="dropdown-content">
        <paper-item id="buyinfantry" on-click="_onClick">{{localize('buyinfantry')}}</paper-item>
        <paper-item id="buymounted" on-click="_onClick">{{localize('buymounted')}}</paper-item>
        <paper-item id="buyartillery" on-click="_onClick">{{localize('buyartillery')}}</paper-item>
        <paper-item id="buyaircraft" on-click="_onClick">{{localize('buyaircraft')}}</paper-item>
    </paper-tabs>
</paper-menu-button>		
		
	<paper-icon-item id="buyarmy" on-click="_onClick"> 
	  <iron-icon src="images/figures/army.svg" slot="item-icon"></iron-icon> 
	  <span>{{localize('purchasearmy')}}</span> 
	</paper-icon-item>
	
	<paper-icon-item id="buyscout" on-click="_onClick"> 
	  <iron-icon src="images/figures/scout.svg" slot="item-icon"></iron-icon> 
	  <span>{{localize('purchasescout')}}</span>
    </paper-icon-item>
    
<!--     
    <paper-icon-item id="undospendtrade" on-click="_onClick"> 
        <iron-icon icon="icons:undo" slot="item-icon"></iron-icon> 
        <span>{{localize('undospendtrade')}}</span> 
    </paper-icon-item> -
-->    

    <div class="undobuttons">
            
      <paper-icon-item id="sendproduction" on-click="_onClick"> 
        <iron-icon src="images/tokens/production.svg" slot="item-icon"></iron-icon> 
        {{localize('sendproduction')}}
      </paper-icon-item>
      
      <paper-icon-item class="undo" id="undosendproduction" on-click="_onClick" title="{{localize('undosendproduction')}}">
       <iron-icon icon="icons:undo" slot="item-icon"></iron-icon> 
      </paper-icon-item>
      
    </div>
    
    <div class="undobuttons">
        
      <paper-icon-item id="spendtrade" on-click="_onClick"> 
        <iron-icon src="images/tokens/trade.svg" slot="item-icon"></iron-icon>        
         {{localize('spendtrade')}}
      </paper-icon-item>
        
      <paper-icon-item class="undo" id="undospendtrade" on-click="_onClick" title="{{localize('undospendtrade')}}"> 
          <iron-icon icon="icons:undo" slot="item-icon"></iron-icon> 
      </paper-icon-item>
      
    </div>
    
    
<!--  <paper-menu-button> -->
<!--  
    <paper-icon-item slot="dropdown-trigger">
      <iron-icon icon="menu" slot="item-icon"></iron-icon>       
      <span>{{localize('units')}}</span>
    </paper-icon-item>
-->
<!--   </paper-menu-button> -->

</span>
     

<span id="movement" class="actionbox" style="display:none">     
	
	<paper-icon-item id="startmove" on-click="_onClick">
	<iron-icon icon="fingerprint" slot="item-icon"></iron-icon> <span>{{localize('startmove')}}</span> </paper-icon-item>
	<paper-icon-item id="move" on-click="_onClick"> <iron-icon
		icon="rowing" slot="item-icon"></iron-icon> <span>{{localize('continuemove')}}</span>
	</paper-icon-item>
	<paper-icon-item id="revealtile" on-click="_onClick">
	<iron-icon icon="lock-open" slot="item-icon"></iron-icon> <span>{{localize('revealtile')}}</span> </paper-icon-item>
	<paper-icon-item id="endofmove" on-click="_onClick">
	<iron-icon icon="pan-tool" slot="item-icon"></iron-icon> <span>{{localize('endofmove')}}</span> </paper-icon-item>
</span>		


<span id="research" class="actionbox" style="display:none">     
</span>		
</template> 

<script>
      
class CivPlayer extends Polymer.CivLocalize(Polymer.GestureEventListeners(Polymer.Element)) {
      
	static get is() { return 'civ-player' }

    static get properties() {
		
		return {
                               
              civname: {
                  type: String,
                   value: undefined
               },
               numberoftrade : {
                    type : String,
                    value : undefined
                },
                citieslimit : {
                    type : String,
                    value : undefined
                },
                armieslimit : {
                    type : String,
                    value : undefined
                },
                scoutslimit : {
                    type : String,
                    value : undefined
                },
                currentcommand : {
                    type : String,
                    value : undefined
                },
                itemizedcommand : {
                    type : Object,
                    value : undefined,
                    observer: '_itemized'
                },
                figurecolor1 : {
                    type: String,
                    value: function() { return C.color1(); }
                },
                
                listofpoints : {
                	type : Array,
                	value : null
                },
                
                opponent : {
                	type : Boolean
                },
                
                actionpanels : {
                	type : Array,
                    readOnly: true,
                	value :
                    [
                         "startofturn",
                         "trade",
                         "citymanagement",
                         "movement",        
                         "research"
                    ]
                },
                 
               buttons : {
            	   type : Array,
                   readOnly: true,
            	   value : [            	   
                            "setcapital",
                            "endofphase",
                            "setarmy",
                            "setscout",        
                            "buyarmy",
                            "buyscout",
                            "startmove",
                            "move",
                            "revealtile",
                            "endofmove",
                            "setcity",
                            "spendtrade",
                            "undospendtrade",
                            "sendproduction",
                            "undosendproduction",
                            "buymounted",
                            "buyartillery",
                            "buyinfantry",
                            "buyaircraft"                            
                  ],
             }
	   }
    }
    
    setListOfPoints(a) {
        C.highlightGame(this.listofpoints,false);
        C.highlightGame(a,true);
        this.listofpoints = a;    	
    }
            
    _itemized(newValue,oldValue) {
    	const a = C.getlistofpoints(this.currentcommand,newValue);
    	this.setListOfPoints(a)
    }
                 
    _callitemize(id) {
       this.currentcommand = id
       window.itemizecommand(id.toUpperCase())    	
    }
        
    _onClick(source) {
    	     if (this.opponent) return
    	     if (C.issendproductionscout()) {
    	    	 C.alertdialog(C.localize('specifythesuqretoharvest') + " !")
    	    	 return
    	     }    	     
             var id = source.currentTarget.id
             if (id == "endofphase") {
                this.currentcommand = null
                const g= C.getjsboard().board.game
                const phase = g.phase
                const labelphase = C.getphasedescr(phase)
                C.confexecutedialog(this.localize("doyouwantendquestion","phase",labelphase),id,-1,-1,phase)
                return
             }
            if (id == "endofmove") {
               this.currentcommand = null
               C.confexecutedialog(this.localize("doyouwantfinishmovequestion"),id,-1,-1,null)
               return
            }
            
           this._callitemize(id) 
         }
    
     
         clear() {
             this.itemizedcommand = null;
             this.listofpoints = null;
             this.currentcommand = null;        
         }
         
         clearCommand() {
        	 this.clear()
         }
                  
         draw(b, y, opponent) {
        	   if (b == null) {
        		   this.clear()
        		   return;
        	   }
        	   this.opponent = opponent
               C.setColorForCity(this,"civname",C.backcolorForCiv(y.civ))
               this.civname=y.civ
               this.numberoftrade = "Trade: " + y.trade
               this.citieslimit = "Cities left: " + y.citylimit
               this.armieslimit = "Armies left: " + y.armieslimit
               this.scoutslimit = "Scouts left: " + y.scoutslimit
               
               const g = b.board.game
               const pha = g.phase.toLowerCase()
               for (var i=0; i < this.actionpanels.length; i++) {
                   const id = this.actionpanels[i]
                   const pa = this.shadowRoot.getElementById(id);
                   if (id == pha) C.displayelem(pa,true)
                   else C.displayelem(pa,false)
                }

               
               for (var i=0; i < this.buttons.length; i++) {
                  const id = this.buttons[i]
                  const bu = this.shadowRoot.getElementById(id);
                  C.disableleme(bu,true)
               }
              for (var i=0; i<y.commands.length; i++) {
                  const command = y.commands[i]
                  const id = command.command.toLowerCase()
                  const bu = this.shadowRoot.getElementById(id);
                  C.disableleme(bu,false)
                  if (!opponent && id == "move" && this.currentcommand != "revealtile") 
                	  this._callitemize(id)
                 }
              C.setUnitsNumb(this,y.units.units)
             }
        }
        
window.customElements.define(CivPlayer.is, CivPlayer);
        
        
</script> 

</dom-module>