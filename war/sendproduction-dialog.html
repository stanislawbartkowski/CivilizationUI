 <dom-module id="sendproduction-dialog">
    <template>
  
    <style>   
       :host {
        display: block;
      }
            
    </style>
    
    
    <paper-dialog id="dialog">
      <h3 id="sendproductiontitle" style="display:none">{{localize('youareabouttosendproduction')}}</h3>
      <h3 id="harvestresourcetitle" style="display:none">{{localize('youareabouttoharvestresource')}}</h3>
      <p/>

      <civ-square id="square" row="-1" col ="-1"></civ-square>
      
      <div>{{localize('specifythesuqretoharvest')}}</div>
      
      </p>
      <div><civ-square id="scout" row="-1" col ="-1"></civ-square></div>
            
            
      <div class="buttons">

        <paper-button id="sendproductionbutton" style="display:none" on-click="_onSend">
            <iron-icon src="images/tokens/production.svg"></iron-icon>  
           {{localize('sendproduction')}}
        </paper-button>

        <paper-button id="harvestresourcebutton" style="display:none" on-click="_onSend">
            <iron-icon icon="icons:build"></iron-icon>  
           {{localize('harvestresource')}}
        </paper-button>
                
        <paper-button on-click="_onCancel" dialog-dismiss>{{localize('cancellabel')}}</paper-button> 
      </div>
      
    </paper-dialog>
  </template>

  <script>
      class SendProductionDialog extends Polymer.CivDialog(Polymer.DialDraggable(Polymer.Element)) {
    	  
      static get is() { return 'sendproduction-dialog'; }
      
      static get properties() {
          return {
            scout : {
            	type : Object
            },
            names : {
               type : Array,
               readOnly: true,
               value :
                [
                   "harvestresource",
                   "sendproduction"
                ]
            },
            harvestresource : {
            	type : Boolean
            }

          }
      }
            
      _setScoutPoints() {
    	  const pa = this.data
    	  const itemize = pa.itemized
          const a = []
          for (var i=0; i<itemize.length; i++) {
        	  const ci = itemize[i].p
        	  const sco = itemize[i].param
        	  if (C.eqp(ci,pa)) a.push(sco)
          }
    	  C.setlistofpoints(a)
      }
      
      _onSend() {
    	  if (this.scout == null) {
    		  C.alertdialog(C.localize('specifythesuqretoharvest') + " !")
    		  return
    	  }
    	  const scout = this.scout
          var command = "SENDPRODUCTION"
          if (this.harvestresource) command = "HARVESTRESOURCE"
          C.executewithconffun(this.localize('areyousurequestion'),command,e => {
              this.closeIt()
              const pa = this.data
              const c = this.scout              
              pa.param = C.constructP(c.row,c.col)
              C.executeC(command,pa)
          })          
      }
      
      _clearLabels() {
          for (var i=0; i<this.names.length; i++) {
              C.displayelemid(this,this.names[i] + "title",false)    	  
              C.displayelemid(this,this.names[i] + "button",false)        
          }
      }
      
      _clearSquare() {
    	  this._clearLabels()
          C.clearCommand()
          const sq = this.$.square
          sq.draw(null)
          const sc = this.$.scout
          sc.draw(null)
      }
      
      _onCancel() {
    	  this._clearSquare()
      }
      
      setScout(pa) {
          const sc = this.$.scout
    	  this.scout = pa
    	  sc.draw(pa.square)
      }
      
      openIt(pa) {
    	  this.harvestresource =  C.iscurrentcommand("harvestresource")
    	  this._clearLabels()
    	  C.displayelemid(this,C.getcurrentcommand() + "title",true)
          C.displayelemid(this,C.getcurrentcommand() + "button",true)
          const sq = this.$.square
          C.setShadowStyleAttribute(sq,":host","float",null)
          const sc = this.$.scout
          C.setShadowStyleAttribute(sc,":host","float",null)
          sq.draw(pa.square)
          sc.draw(null)
          this.scout = null
    	  C.setcurrentcommand("selectscout")
    	  super.openIt(pa)
    	  super.noCancelOnOutsideClick()
          this._setScoutPoints()
      }
           
    }

    window.customElements.define(SendProductionDialog.is, SendProductionDialog);
  </script>
</dom-module>