 <dom-module id="civ-listunits">


<template>

   <template id="map" is="dom-repeat" items="{{units}}">
           <civ-units class="unit" data="{{item}}" draggable="{{draggable}}" num="{{index}}" you="{{you}}"></civ-units>
    </template>
    
    <div id="empty" style="display:none">
       {{localize('nounits')}}
    </div>

    <span id="units" style="display:none">
      <civ-units class="unitelem" id="infantry"></civ-units>
      <civ-units class="unitelem" id="artillery"></civ-units>
      <civ-units class="unitelem" id="mounted"></civ-units>
      <civ-units class="unitelem" id="aircraft"></civ-units>
    </span>


  </template>

  <script>
      class CivListUnits extends Polymer.CivData(Polymer.Element) {

      static get is() { return 'civ-listunits'; }

      static get properties() {
          return {
              units: {
                  type: Array
              },
              draggable : {
                type : Boolean
              },
              you : {
                type : Boolean
              }
          }
      }

      _findLevel(pa,name) {
        return C.findUnitLevel(pa.units,name)
      }

      _islist(pa) {
    	 return (pa.list != null)
      }

      _showunits(show) {
    	  C.displayelemid(this,"units",show,true)
      }

      _drawlist(pa) {
    	  this._showunits(false)
          C.displayelemid(this,"empty",false)    	  
          const l = pa.list
          if (l.length == 0) {
              C.displayelemid(this,"empty",true)       
        	  return
          }
          this.units = []
          for (var i=0; i<l.length; i++) {
              const elem = {}
              elem.name = l[i].name
              elem.strength = l[i].strength
              elem.level = this._findLevel(pa,elem.name)
              this.units.push(elem)
          }
      }

      _drawunits(pa) {
          this._showunits(true)
          C.setUnitsNumb(this.$.units,pa)
          const fun = this.fun
          for (var i=0; i<pa.units.length; i++) {
            const n = pa.units[i].name.toLowerCase()
            const ee = this.$[n]
            if (pa.units[i].num >= 1) ee.fun = p => fun(p)
            else ee.fun = null
          }
      }

      //  pa.list (of units)
      //  or
      //
      refresh(pa) {
    	  if (this._islist(pa)) this._drawlist(pa)
    	  else this._drawunits(pa)
      }

    }

    window.customElements.define(CivListUnits.is, CivListUnits);
  </script>
</dom-module>
