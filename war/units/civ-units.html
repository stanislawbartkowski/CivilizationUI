<dom-module id="civ-units">
<template>

<custom-style>

<style is="custom-style" >

:host {
  display: inline-block;
  /*box-sizing: border-box;*/
  /* margin: 1px solid; */
  border-radius: 5px;
  width: 77px;
  height: 70px;
  vertical-align: top;
  /* important, avoid spilling out numbers */
  line-height : 12px;
}

:host([infantry]) {
  background-color: #FFE4C4;
}

:host([mounted]) {
  background-color: #A9A9A9;
}

:host([artillery]) {
  background-color: #ADD8E6;
}

:host([aircraft]) {
  background-color: #98FB98;
}


paper-badge {
  --paper-badge : {
    margin-bottom:-15px;
  }
}

  .top {
      width: 100%;
      height: 25%;
      border-bottom: 1px inset;
  }

  .left {
      width: 20%;
      height: 75%;
      float:left;
  }
  .main {
      float: left;
      height: 80%;
      width: 80%
   }

   .unitfigure {
/*     display : none; */
     width:80%;
/*     float:left; */
   }

   .imagelevel {
     width:20%;
     top : 0px;
/*     float:right; */
     padding-top: 2px;
     display:none;
   }

   .strenghtup {
     margin-top:-0.75em;
   }

   .unitstrength {
     font-size:70%;
/*     margin-top:-0.05em; */
     color: blue;
   }

</style>

</custom-style>

<div style="height:100%; width:100%" draggable="true"
   ondragstart="CivUnitsDraggable.ondragStart(event)"
   >
  <div class="top">

      <span id="strengthvalue" style="width:10%; display=none; color:red">{{strengthvalue}}</span>
      <span id="unitname" style="width:60%; font-size:80%" >{{unitname}}</span>

      <s-svg id="imagelevel0" class="imagelevel" style="width:10px"src="images/units/unit-level0.svg"></s-svg>
      <s-svg id="imagelevel1" class="imagelevel" src="images/units/unit-level1.svg"></s-svg>
      <s-svg id="imagelevel3" class="imagelevel" src="images/units/unit-star.svg"></s-svg>
      <s-svg id="imagelevel2" class="imagelevel" src="images/units/unit-level2.svg"></s-svg>
  </div>
  <div class="left" id="strength">
     <div id="level0" class="unitstrength"></div>
     <div id="level1" class="unitstrength"></div>
     <div id="level2" class="unitstrength"></div>
     <div id="level3" class="unitstrength"></div>
  </div>
  <div class="main" >
     <img id="mounted" class="unitfigure" hidden fill="DarkSlateGray" src="images/units/unit-mounted.svg"></img>
     <img id="artillery" class="unitfigure" hidden  fill="DarkSlateGray" src="images/units/unit-artillery.svg"></img>
     <img id="infantry" class="unitfigure" hidden fill="DarkSlateGray" src="images/units/unit-infantry.svg"></img>
     <img id="aircraft" class="unitfigure" hidden fill="DarkSlateGray" src="images/units/unit-aircraft.svg"></img>
     <paper-badge hidden id="mountednumber" for="mounted" label="X">
      </paper-badge>
     <paper-badge hidden id="infantrynumber" for="infantry" label="X">
     </paper-badge>
     <paper-badge hidden id="artillerynumber" for="artillery" label="X">
     </paper-badge>
     <paper-badge hidden id="aircraftnumber" for="aircraft" label="X">
     </paper-badge>
  </div>
</div>

</template>

<script>

class CivUnits extends Polymer.CivChooseData(Polymer.Element) {

    static get is() {
    	return 'civ-units';
    	}


    // Declare properties for the element's public API
    static get properties() {
      return {
          boxwidth: {
              type: Number,
              readOnly: true,
              value: 70
          },
        boxheight: {
            type: Number,
            readOnly: true,
            value: 70
          },
        strengthvalue : {
          type : Number
        },
        unitname : {
          type : String
        },
        unittypes : {
          type : Array,
          readOnly: true,
          value : ["mounted","aircraft","infantry","artillery"]
        },
        units : {
        	type : Object
        },
        draggable: {
          type : Boolean
        },
        num: {
            type: Number
        },
        you : {
          type : Boolean
        },
        hobject : {
          type : Object
        }
    }

  }

  isDraggable() {
    return this.draggable && this.num != null
  }

  getTarget(e) {
    const u = Polymer.Gestures.deepTargetFind(e.detail.x, e.detail.y)
    if (u == null) return null
    if (u.tagName.toUpperCase() != "CIV-FRONTUNIT") return null
    if (u.you != this.you) return null
    if (!u.isEmptySlot) return null
    return u
  }

//  handleClick() {
//	  if (this.units == null) return
//	  C.showunits(this.units)
//  }

  _displaysvg(n,display) {
      const u = this.$[n]
      C.showeleme(u,display)
  }

  _clearimages() {
  	this.listofunits = null
    for (var i=0; i<this.unittypes.length; i++)
      this._displaysvg(this.unittypes[i],false)
    for (var i=0; i<this.unittypes.length; i++)
      C.showeleme(this.$[this.unittypes[i]+'number'],false)
    C.displayelem(this.$.strengthvalue,false)
    for (var i=0; i<=3; i++)
      C.showeleme(this.$["imagelevel"+i],false)
    for (var i=0; i<this.unittypes.length; i++)
      C.removeattr(this,this.unittypes[i])
  }

  _unitName(n) {
     return C.localize(n)
  }

  // data {
  // {
  //     data.name
  //     data.strength (can be null)
  //     data.level (can be null)
  //     data.num (1 or > 1)
  // }
  refresh(data) {
//    if (this.isDraggable()) this.setAttribute("draggable","true")
    this._clearimages()
    if (data == null) return
    const n = data.name.toLowerCase()
    this.setAttribute(n,1)
    if (data.strength != null)
      for (var i=0; i<data.strength.length; i++)
         this.$["level"+i].innerText = data.strength[i]
    else
    for (var i=0; i<4; i++)
       this.$["level"+i].innerHTML = "&nbsp;"

    this.unitname = this._unitName(n)
    if (data.level != null) {
       C.displayelem(this.$.strengthvalue,true,true)
       if (data.strength != null) this.strengthvalue = data.strength[data.level]
       C.displayelem(this.$["imagelevel"+data.level],true,true)
     }
    if (data.num != null && data.num > 0) this._displaysvg(n,true)
    if (data.strength != null) this._displaysvg(n,true)
    if (data.num != null)
      C.displaybadge(this.$[n+'number'],data.num)
  }

}

  // Register the x-custom element with the browser
  customElements.define(CivUnits.is, CivUnits);
</script>

</dom-module>
