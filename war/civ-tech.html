<dom-module id="civ-tech">
<template>

<custom-style>

<style is="custom-style" >

:host {
    display: inline-block;
    border : 1px solid;
    border-radius: 5px;
    width: 115px;
    height: 60px;
    vertical-align: top;
    padding : 5px;
    position: relative;

  }

:host([disa]) {
  background-color : #afa7a7
}

.name {
  display:inline-block;
  width:80%;
  height:50%
}

.gover {
  background-color: #ecd6ba;
  padding : 2px;
}

.building {
  background-color: #dfeaf1;
  position:absolute;
  bottom : 0px;
  width: 93%;
}

.text {
  position:absolute;
  bottom : 0px;
  right: 2px;
}

.not {
  height:15px;
  vertical-align: top;
}

</style>

</custom-style>

<div>
  <div class="name">{{name}}</div>
<!-- <img id="notimplemented" src="images/icons/thumbdown.svg" class="not" title="{{localize('notimplemented')}}"></img> -->
  <civ-implemented id="notimplemented" class="not"></civ-implemented>
  <div class="gover" id="gover">{{gover}}</div>
  <div class="building" id="building">{{building}}</div>
   <civ-helptext id="helptext" class="text"></civ-helptext>
</div>

</template>

<script>
class CivTech extends Polymer.CivData(Polymer.GestureEventListeners(Polymer.Element)) {

    constructor() {
       super();
       Polymer.Gestures.addListener(this, 'tap', () => this.handleClick());
    }

    static get is() {
    	return 'civ-tech';
    	}

      static get properties() {
        return {
            name: {
              type: String
            },
            level : {
              type : Number
            },
          }
        }

    handleClick() {
      if (this.data.disa) return
      if (this.data.clickTech != null) this.data.clickTech(this.data)
    }

    _name() {
      const n = this.tech
      return n.name
    }

    _gover() {
      const n = this.tech
      return n.gover
    }

    _building() {
        const n = this.tech
        return n.building
    }

    _ni() {
      const n = this.tech
      return n.ni
    }

    _level() {
        const n = this.tech
        return n.level

    }

    _setuptech() {
    	const d = this.data
    	if (d.name != null) {
    		this.tech = d
    		return
    	}
    	// look for tech
      this.tech = C.findTech(this.data.tech)
    }

    _disa(d) {
        if (this.data.disa) C.setattr(this,"disa",1)
        else C.removeattr(this,"disa")
    }

    refresh(data) {
      this._setuptech()
      const h = this.$.helptext
      h.setHelpText(this.tech.desc)
      this.name = C.localize(this._name())
      if (this.name == null || this.name == "") this.name = "*" + this._name()
//      C.displayelemid(this,"notimplemented",this._ni(),true)
      const ni = this.$.notimplemented
      ni.draw(this._ni())
      C.displayelemid(this,"gover",false,true)
      C.displayelemid(this,"building",false,true)
      this.gover = this._gover()
      this.building = C.localize(this._building())
      if (this.gover != null) C.displayelemid(this,"gover",true)
      if (this.building != null) C.displayelemid(this,"building",true)
      this._disa()
    }

    refresh1(pa) {
      const disa = pa.disa
      const level = pa.playerlevel
      const n = this._name()
      this.data.disa = false
      if (level < this._level()) this.data.disa = true
      else this.data.disa = C.onList(disa,n)
      this._disa()
    }

}

customElements.define(CivTech.is, CivTech);

</script>

</dom-module>
