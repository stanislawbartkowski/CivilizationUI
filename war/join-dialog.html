 <dom-module id="join-dialog">
  <template>
    <style>
       :host {
        display: block;
      }
      
  paper-button {
    font-family: 'Roboto', 'Noto', sans-serif;
    font-weight: normal;
    font-size: 14px;
    -webkit-font-smoothing: antialiased; 
    margin : 10px;
    border-radius: 5px;
  }
  
  paper-button.green {
    background-color: var(--paper-green-500);
    color: white;
  }
  paper-button.green[active] {
    background-color: var(--paper-red-500);
  }
  paper-button.disabled {
    color: white;
  }
      
    </style>
    
    
    <paper-dialog id="dialog" modal>
      <h3>{{header}}</h3>
      <p/>
      <p>
        <span
         style="
         box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2); 
         padding:12px;
         margin: 0px,24px;
         border-radius: 5px; background-color: #fff; color: #252525;"
         >  
        You are playing {{civname}}
        </span>
      </p>
      
      <p>Choose opponent civilization to start</p>
      <p/><p/>
      
      <p>
      <template id="civs" is="dom-repeat" filter="notUsed" items="{{lines}}">
      
       <paper-button id="{{item}}" raised class="green" on-click="_onClickCiv">{{item}}</paper-button>
                       
      </template>
      </p>

       <span id="waiting" hidden>
         <span style="padding-right:10px; ">Waiting for opponent to join</span> <paper-spinner active></paper-spinner>
       </span>      
                  
      <div class="buttons">
<!--       <paper-button dialog-dismiss on-click="_onCancel">Cancel</paper-button> -->
        <paper-button on-click="_onCancel">Cancel</paper-button> 
      </div>
      
    </paper-dialog>
  </template>

  <script>
    class JoinDialog extends Polymer.Element {
      static get is() { return 'join-dialog'; }
      static get properties() {
        return {
          civname: {
            type: String,
            value: undefined
          },
          header: {
              type: String,
              value: undefined
          },
          gameid : {
        	  type : Number,
        	  value : undefined
          },
          lines : {
        	  type : Array,
              value : []
          }
        };
      }

      ready() {
        super.ready();
      }
      
      notUsed(item) {
    	  return item != this.civname
      }
      
      _disablecivs(disable) {
    	  var d = this.$.dialog
          for (var i = 0; i < this.lines.length; i++) {
       	     var ge=d.querySelector("#" + this.lines[i])
       	     if (ge != null) C.disableleme(ge,disable)
          }
       	     
      }
      
      _showwaiting(show) {
    	  var e = this.$.waiting
    	  C.showeleme(e,show)    	  
      }
      
      _onCancel() {
    	  C.unregistertoken()
    	  C.closejoindialog()
      }
      
      openIt() {
    	  this._showwaiting(false)
    	  this._disablecivs(false)
          this.$.dialog.open();
        }
      
      closeIt() {
          this.$.dialog.close();
        }

      
      _onClickCiv(p) {
    	  const civo = p.target.id
   		  const dialogDemo = C.getconfirmdialog()
    	  dialogDemo.openDialog = function(e) {
    		 this.$.dialog.open()
          }
    	  dialogDemo.confirm = e => {
        	  this._disablecivs(true)
        	  this._showwaiting(true)
        	  if (this.gameid > 0) C.resumetwoplayersgame(this.gameid,this.civname)
        	  else C.registertwoplayersgame(this.civname,civo)
    	  }
    	  dialogDemo.dismiss = e => {}
    	  dialogDemo.message = "Do you want to start two players game as " + this.civname + " against " + civo + " ?"
    	  dialogDemo.openDialog()
      }

    }

    window.customElements.define(JoinDialog.is, JoinDialog);
  </script>
</dom-module>